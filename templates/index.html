<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html prefix="og: http://ogp.me/ns#" lang="en" style="height: 100%">

<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>

    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=5" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>HiLo's Summarizer</title>
    <meta name="description" content="bart summarizer Description">
    <meta property="og:title" content="bart summarizer">
    <meta property="og:description" content="bart summarizer Description">
    <meta name="generator" content="Quest">
    <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:300,500,600,700,800">
    <link rel="icon" sizes="57x57" href="../static/assets/images/hilogo.png" />
</head>

<body class="websiteBody">

    <div class="WebHeadlines">
        <h1>HiLo Summarize Tool</h1>
        <h2>Why not leveraging technology to save
            <br>your time and allow you to utilize it for
            <br>focusing on what really matters?
            <br>
            <br>
        </h2>
    </div>

    <form action="/index" method="POST" enctype="multipart/form-data">
        <!-- Load File Button -->
        <div class="upldbtn-out">
            <input type="file" name="file1" id="file1" />
            <label class="upldbtn" for="file1">Upload a file</button>
        </div>
        <!-- 'buttonSummarize-outer' -->
        <!-- Drag&Drop Box -->
        <div class="drag-drop-outer">
            <div class="dropzone" id="dropzone">
                <!-- <p id="textInside"></p>-->
                <label class="button" id="btndd" for="fileElem">Drag a file here</label>
                <input type="file" name="file2" id="fileElem">
            </div>
        </div>
        <br>
        <!-- max words box -->
        <div class="max-words-outer">
            <div id="max-words-box" class="max-words-box">
                <label for="max-words"></label>
                <input type="number" id="max-words" name="max-words" defaultValue="100" min="100" step="10"
                    placeholder="Summary's max words...">
            </div>
        </div>
        <!-- percentage box -->
        <div class="percentage-box-outer">
            <div id="percentage-box" class="percentage-box">
                <label for="percentage"></label>
                <input type="number" id="percentage" name="percentage" min="10" max="100"
                    placeholder="Summary's length in percentages...">
            </div>
        </div>


        <!--  -->
        <script type="text/javascript">

            function findEntities() {
                var flag = false;
                //get the dictionary that was sent from python (supposed to be inivisible)
                json_dict = document.getElementById('dictionary').innerHTML;
                // json_dict = { "abstract of title": "A written history of all the transactions related to the title for a specific tract of land. An abstract of title covers the period from the original source of title (often the original land grant from the United States government to an individual) to the present time and summarizes all subsequent documents that have been recorded against that tract.", "benjamin": "A buyer\u2019s or seller\u2019s agreement to enter into a contract and be bound by the terms of the offer." };

                json_dict = JSON.parse(json_dict);
                summarize = document.getElementById('temp').innerHTML; // iterate over keys of json object 
                console.log(summarize);
                if (summarize === " ") {
                    summarize = document.getElementById('Summary').innerHTML;
                    flag = true;
                }
                for (index in json_dict) {
                    // console.log(JSON.stringify(index));
                    if (summarize.includes(index) === true) {
                        // summarize = summarize.replace(index, '<b>' + index + '</b>');
                        summarize = summarize.replace(index, '<div class="tooltip"><b>' + index + '</b><span class="tooltiptext">' + json_dict[index] + '</span></div >');
                    }
                }
                if (flag === true)
                    document.getElementById('Summary').innerHTML = summarize;
                else document.getElementById('temp').innerHTML = summarize;
            }
        </script>
        <!-- Button summarizer -->
        <div class="buttonSummarize-outer">
            <label for="SummarizeButton"></label>
            <input type="submit" id="SummarizeButton" name="SummarizeButton" value="Summarize!" onclick="$('#loading').show();
                document.getElementById('temp').innerHTML='';
                document.getElementById('nofile').innerHTML ='';
                ">
        </div>
        <div class="buttonEntities-outer">
            <label for="entities"></label>
            <button type="button" id="entities" name="entities" value="Scan for terms!" onclick="findEntities()">Scan
                for terms</button>
        </div>
    </form>
    <br>
    <!-- SUMMARIZATION TEXT BOX -->
    <div class=" textsummary-outer">
        <div id="textsummary" data-name="textsummary" alt="textsummary" class="textsummary">
            <div name='summary'>
                <br>
                <br>
                <p id="Summary"></p>
                <p id="temp">{{summary}} </p>
                <p id="dictionary" style="visibility: none; display:none;"> {{dictionary}} </p>
                <p id='filename' style="opacity: 0;">{{name}}</p>
                <p id="nofile">{{error}}</p>
                <!-- <p>{{ content }}</p> -->
                <div id="loading" style="display:none;">
                    <img src="../static/assets/images/loading.gif" alt="" />
                    <br>
                    <!-- <img src="../static/assets/images/bar1.gif" alt="" /> -->
                    <p>Summarization in process...</p>
                </div>

            </div>
        </div>
    </div>

    <!-- BOTTOM RIGHT BUTTONS SECTION -->
    <div class="sharing_buttons">
        <br>
        <!-- SAVE FUNCTION -->
        <div class="download-summary-outer">
            <input type="submit" id="outer_download_button" value="Download"
                onClick="download(document.getElementById('filename').innerHTML,document.getElementById('temp').textContent)">
            <!-- </form> -->
        </div>
        <!-- EMAIL -->
        <a class="fa fa-google" id="mail" href="" title="Share by Email" style="background: #dd4b39;
        color: white;  width:20px;">
        </a>
        <!-- LINKEDIN -->
        <a class="fa fa-linkedin" id="linkedin" href="" style="background: #007bb5;
        color: white;  width:20px;"
            onclick="window.open(this.href, 'mywin', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;">
        </a>
        <!-- TWITTER -->
        <a class="fa fa-twitter" id="twitter" href="" style="  background: #55ACEE;
        color: white; width:20px;"
            onclick="window.open(this.href, 'mywin', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"></a>
        <input type=button id="register" value='SAVE' onClick=to_open()>
    </div>
</body>

<script type="text/javascript">
    //open registration window
    function to_open() {
        const openWindow = window.open(
            "http://localhost/test/form.html",
            "rating",
            "width=400,height=520,left=150,top=200"
        );
        const timer = setInterval(() => {
            if (openWindow.closed) {
                clearInterval(timer);
                // alert('"Secure Payment" window closed!');
                document.getElementById("outer_download_button").click();
            }
        }, 500);
    }
    // Gets variable from URL
    function getUrlVars() {
        var vars = [],
            hash;
        var hashes = window.location.href
            .slice(window.location.href.indexOf("?") + 1)
            .split("&");
        for (var i = 0; i < hashes.length; i++) {
            hash = hashes[i].split("=");
            vars.push(hash[0]);
            vars[hash[0]] = hash[1];
        }
        return vars;
    }

    function getUrlParam(parameter) {
        var urlparameter;
        if (window.location.href.indexOf(parameter) > -1) {
            urlparameter = getUrlVars()[parameter];
        }
        return urlparameter;
    }

    serialize = function (obj) {
        var str = [];
        for (var p in obj)
            if (obj.hasOwnProperty(p)) {
                str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
            }
        return str.join("&");
    };
    // Loading that parameter if present
    window.onload = function () {
        var mytext = getUrlParam("Summary");
        var my_ready_dictionary = getUrlParam("Dictionary");
        if (mytext !== undefined) {
            document.getElementById("Summary").innerHTML = decodeURIComponent(mytext);
            document.getElementById("dictionary").innerHTML = decodeURIComponent(my_ready_dictionary);
        }

        var url = "http://127.0.0.1:5000/index?";
        // var url = "http://mywebsite.com/index?";

        //get summary&dictionary from previously loaded file
        var summary_for_url = document.getElementById("temp").innerHTML;
        var dictionary_for_url = document.getElementById("dictionary").innerHTML;
        if (summary_for_url != " ") {
            //create encoded summary for URL
            var url_variables = serialize({ Summary: String(summary_for_url), Dictionary: String(dictionary_for_url) });

            url = url + url_variables;
            console.log(url);
        }
        //SHORTEN URL//
        var shorturl;
        var data = {
            "domain": "1pie.short.gy",
            "originalURL": decodeURIComponent(url)
        };

        fetch('https://api.short.io/links/public', {
            method: 'post',
            headers: {
                'accept': 'application/json',
                'Content-Type': 'application/json',
                'authorization': 'pk_cGdSPwfEMvDXGUy6'
            },
            body: JSON.stringify(data)
        }).then(function (response) {
            return response.json();
        }).then(function (data) {
            shorturl = data.shortURL;
        }).then(function () {

            //MAIL CODE
            var p1 = "mailto:?body=Check out this Article Summarization by HiLo ";
            var p2 = "&subject=HiLo's Summarization Tool";
            var mail = p1 + shorturl + p2;
            var a = document.getElementById("mail");
            a.href = mail;

            //LINKEDIN CODE
            var linkedin =
                "https://www.linkedin.com/shareArticle?mini=true&url=" +
                url +
                "&title=Temporary Title&source=Chillyfacts";
            var b = document.getElementById("linkedin");
            b.href = linkedin;

            //TWITTER CODE
            var twitter =
                "https://twitter.com/intent/tweet?text=" + shorturl;
            var c = document.getElementById("twitter");
            c.href = twitter;
        })
    };
</script>
<script type="text/javascript" src="../static/index.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script type="text/javascript">
    jQuery("input#fileElem").change(function () {
        alert("File Chosen")
    });
    jQuery("input#file1").change(function () {
        alert("File Chosen")
    });
    jQuery("input#file1").change(function () {
        $('html,body').animate({
            scrollTop: $(".buttonSummarize-outer").offset().top
        },
            'slow');
    });
    jQuery("input#fileElem").change(function () {
        $('html,body').animate({
            scrollTop: $(".buttonSummarize-outer").offset().top
        },
            'slow');
    });
</script>

</html>
